import{_ as D,e as A,c as d,f as h,a,h as N,d as g,t as r,F as B,q as F,j as i,b as c,v,w as q,r as m,i as G,o as u,n as S}from"./index-Jc6aNIQy.js";import{a as C}from"./adminService-oFDKTrp6.js";import{_ as L}from"./Navbar-BmhPClkr.js";import{M as U}from"./bootstrap.esm-D7Q7Nh7Y.js";import"./authStore-BuOsiNc2.js";const P={class:"container mt-4"},R={class:"row mb-4"},J={class:"col-auto"},K={key:0,class:"text-center py-5"},O={key:1,class:"alert alert-danger"},Q={key:2,class:"row g-3"},W={class:"card-body"},X={class:"d-flex justify-content-between align-items-start mb-2"},Y={class:"card-title mb-1"},Z={class:"mb-1"},j={class:"mb-1"},aa={class:"mb-1"},oa={class:"mb-1"},la={class:"mt-3"},ea=["onClick"],ta=["onClick"],sa=["onClick","disabled"],na=["onClick","disabled"],ra={class:"mt-4"},ia={class:"modal-dialog"},da={class:"modal-content"},ua={class:"modal-body"},ma={key:0},ca={class:"mb-3"},va={class:"modal-footer"},ba=["disabled"],pa={class:"modal-dialog modal-lg"},_a={class:"modal-content"},fa={class:"modal-body"},ya={class:"row mb-3"},ga={class:"col-md-6"},Ca={class:"col-md-6"},ka={class:"row mb-3"},wa={class:"col-md-6"},Ea={class:"col-md-6"},ha={class:"row mb-3"},xa={class:"col-md-6"},Ta={class:"col-md-6"},Ma={class:"modal-footer"},Va=["disabled"],Na={__name:"Trabajadores",setup(Sa){const k=m([]),b=m(!0),w=m(""),n=m(null),_=m(""),x=m(null),T=m(null);let f=null,y=null;const e=m({nombre:"",apellido_paterno:"",apellido_materno:"",telefono:"",hora_entrada:"",hora_salida:""});A(async()=>{await E()});const E=async()=>{b.value=!0;try{k.value=await C.getTrabajadores()}catch(t){w.value="Error al cargar trabajadores",console.error(t)}finally{b.value=!1}},H=t=>{n.value=t,_.value="",f||(f=new U(x.value)),f.show()},I=async()=>{var t,o;try{await C.cambiarContrasena(n.value.id,_.value),alert("Contraseña actualizada exitosamente"),f.hide()}catch(s){alert(((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.detail)||"Error al cambiar contraseña")}},$=t=>{n.value=t,e.value={nombre:t.nombre,apellido_paterno:t.apellido_paterno,apellido_materno:t.apellido_materno,telefono:t.telefono,hora_entrada:t.hora_entrada||"",hora_salida:t.hora_salida||""},y||(y=new U(T.value)),y.show()},M=async()=>{var t,o;if(!e.value.nombre){alert("El nombre es requerido");return}try{const s={};if(e.value.nombre!==n.value.nombre&&(s.nombre=e.value.nombre),e.value.apellido_paterno!==n.value.apellido_paterno&&(s.apellido_paterno=e.value.apellido_paterno),e.value.apellido_materno!==n.value.apellido_materno&&(s.apellido_materno=e.value.apellido_materno),e.value.telefono!==n.value.telefono&&(s.telefono=e.value.telefono),e.value.hora_entrada){const l=e.value.hora_entrada.length===5?e.value.hora_entrada+":00":e.value.hora_entrada;l!==n.value.hora_entrada&&(s.hora_entrada=l)}if(e.value.hora_salida){const l=e.value.hora_salida.length===5?e.value.hora_salida+":00":e.value.hora_salida;l!==n.value.hora_salida&&(s.hora_salida=l)}await C.editarUsuario(n.value.id,s),alert("Trabajador actualizado exitosamente"),y.hide(),await E()}catch(s){alert(((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.detail)||"Error al editar trabajador")}},V=async(t,o)=>{var l,p;if(confirm(`¿Estás seguro de ${o?"reactivar":"dar de baja"} este trabajador?`))try{await C.actualizarEstado(t,o),await E()}catch(z){alert(((p=(l=z.response)==null?void 0:l.data)==null?void 0:p.detail)||"Error al actualizar estado")}};return(t,o)=>{const s=G("router-link");return u(),d("div",null,[h(L),a("div",P,[a("div",R,[o[8]||(o[8]=a("div",{class:"col"},[a("h3",null,"Gestión de Trabajadores")],-1)),a("div",J,[h(s,{to:"/admin/crear-trabajador",class:"btn btn-primary"},{default:N(()=>[...o[7]||(o[7]=[a("i",{class:"bi bi-person-plus"},null,-1),i(" Agregar Trabajador ",-1)])]),_:1})])]),b.value?(u(),d("div",K,[...o[9]||(o[9]=[a("div",{class:"spinner-border text-primary",role:"status"},[a("span",{class:"visually-hidden"},"Cargando...")],-1)])])):g("",!0),w.value?(u(),d("div",O,r(w.value),1)):g("",!0),!b.value&&k.value.length>0?(u(),d("div",Q,[(u(!0),d(B,null,F(k.value,l=>(u(),d("div",{key:l.id,class:"col-md-6"},[a("div",{class:S(["card",l.activo?"card-activo":"card-inactivo"])},[a("div",W,[a("div",X,[a("div",null,[a("h5",Y,r(l.nombre)+" "+r(l.apellido_paterno)+" "+r(l.apellido_materno),1),a("span",{class:S(l.activo?"badge bg-success":"badge bg-danger")},r(l.activo?"Activo":"Inactivo"),3)])]),a("p",Z,[o[10]||(o[10]=a("strong",null,"DNI:",-1)),i(" "+r(l.dni),1)]),a("p",j,[o[11]||(o[11]=a("strong",null,"Usuario:",-1)),i(" "+r(l.usuario),1)]),a("p",aa,[o[12]||(o[12]=a("strong",null,"Teléfono:",-1)),i(" "+r(l.telefono),1)]),a("p",oa,[o[13]||(o[13]=a("strong",null,"Horario:",-1)),i(" "+r(l.hora_entrada)+" - "+r(l.hora_salida),1)]),a("div",la,[a("button",{onClick:p=>$(l),class:"btn btn-sm btn-info me-2"},[...o[14]||(o[14]=[a("i",{class:"bi bi-pencil"},null,-1),i(" Editar ",-1)])],8,ea),a("button",{onClick:p=>H(l),class:"btn btn-sm btn-warning me-2"},[...o[15]||(o[15]=[a("i",{class:"bi bi-key"},null,-1),i(" Cambiar Contraseña ",-1)])],8,ta),l.activo?(u(),d("button",{key:0,onClick:p=>V(l.id,!1),class:"btn btn-sm btn-danger",disabled:b.value},[...o[16]||(o[16]=[a("i",{class:"bi bi-x-circle"},null,-1),i(" Dar de Baja ",-1)])],8,sa)):(u(),d("button",{key:1,onClick:p=>V(l.id,!0),class:"btn btn-sm btn-success",disabled:b.value},[...o[17]||(o[17]=[a("i",{class:"bi bi-check-circle"},null,-1),i(" Reactivar ",-1)])],8,na))])])],2)]))),128))])):g("",!0),a("div",ra,[h(s,{to:"/",class:"btn btn-secondary"},{default:N(()=>[...o[18]||(o[18]=[i(" Volver al Inicio ",-1)])]),_:1})])]),a("div",{class:"modal fade",id:"cambiarContrasenaModal",tabindex:"-1",ref_key:"modalContrasenaElement",ref:x},[a("div",ia,[a("div",da,[o[22]||(o[22]=a("div",{class:"modal-header"},[a("h5",{class:"modal-title"},"Cambiar Contraseña"),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),a("div",ua,[n.value?(u(),d("p",ma,[o[19]||(o[19]=i(" Trabajador: ",-1)),a("strong",null,r(n.value.nombre)+" "+r(n.value.apellido_paterno),1)])):g("",!0),a("div",ca,[o[20]||(o[20]=a("label",{class:"form-label"},"Nueva Contraseña",-1)),c(a("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>_.value=l),type:"password",class:"form-control",required:""},null,512),[[v,_.value]])])]),a("div",va,[o[21]||(o[21]=a("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Cancelar ",-1)),a("button",{type:"button",class:"btn btn-primary",onClick:I,disabled:!_.value}," Guardar ",8,ba)])])])],512),a("div",{class:"modal fade",id:"editarTrabajadorModal",tabindex:"-1",ref_key:"modalEditarElement",ref:T},[a("div",pa,[a("div",_a,[o[33]||(o[33]=a("div",{class:"modal-header"},[a("h5",{class:"modal-title"},"Editar Trabajador"),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),a("div",fa,[a("form",{onSubmit:q(M,["prevent"])},[a("div",ya,[a("div",ga,[o[23]||(o[23]=a("label",{class:"form-label"},"Nombre",-1)),c(a("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>e.value.nombre=l),type:"text",class:"form-control"},null,512),[[v,e.value.nombre]])]),a("div",Ca,[o[24]||(o[24]=a("label",{class:"form-label"},"Apellido Paterno",-1)),c(a("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>e.value.apellido_paterno=l),type:"text",class:"form-control"},null,512),[[v,e.value.apellido_paterno]])])]),a("div",ka,[a("div",wa,[o[25]||(o[25]=a("label",{class:"form-label"},"Apellido Materno",-1)),c(a("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>e.value.apellido_materno=l),type:"text",class:"form-control"},null,512),[[v,e.value.apellido_materno]])]),a("div",Ea,[o[26]||(o[26]=a("label",{class:"form-label"},"Teléfono",-1)),c(a("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>e.value.telefono=l),type:"text",class:"form-control"},null,512),[[v,e.value.telefono]])])]),a("div",ha,[a("div",xa,[o[27]||(o[27]=a("label",{class:"form-label"},"Hora Entrada",-1)),c(a("input",{"onUpdate:modelValue":o[5]||(o[5]=l=>e.value.hora_entrada=l),type:"time",step:"1",class:"form-control"},null,512),[[v,e.value.hora_entrada]]),o[28]||(o[28]=a("small",{class:"text-muted"},"Formato: HH:MM:SS",-1))]),a("div",Ta,[o[29]||(o[29]=a("label",{class:"form-label"},"Hora Salida",-1)),c(a("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>e.value.hora_salida=l),type:"time",step:"1",class:"form-control"},null,512),[[v,e.value.hora_salida]]),o[30]||(o[30]=a("small",{class:"text-muted"},"Formato: HH:MM:SS",-1))])]),o[31]||(o[31]=a("div",{class:"alert alert-info"},[a("small",null,[a("i",{class:"bi bi-info-circle"}),a("strong",null,"Nota:"),i(" No se pueden editar el DNI ni el nombre de usuario (son identificadores únicos). ")])],-1))],32)]),a("div",Ma,[o[32]||(o[32]=a("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Cancelar ",-1)),a("button",{type:"button",class:"btn btn-primary",onClick:M,disabled:!e.value.nombre}," Guardar Cambios ",8,Va)])])])],512)])}}},Da=D(Na,[["__scopeId","data-v-95763217"]]);export{Da as default};
