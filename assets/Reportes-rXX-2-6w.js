import{r,e as $,c as t,f as F,a as e,b as m,z as R,v as x,d as i,F as k,q as S,t as n,h as H,m as K,i as Y,o as l,j as G,n as N,A as J}from"./index-Jc6aNIQy.js";import{a as D}from"./adminService-oFDKTrp6.js";import{_ as Q}from"./Navbar-BmhPClkr.js";import{M as Z}from"./bootstrap.esm-D7Q7Nh7Y.js";import"./authStore-BuOsiNc2.js";const W={class:"container mt-4"},X={class:"row mb-4"},ee={class:"col-md-4"},ae={class:"card"},se={class:"card-body"},te={key:0,class:"col-md-4"},le={class:"card"},oe={class:"card-body"},ne={key:1,class:"col-md-4"},de={class:"card"},re={class:"card-body"},ie=["value"],ue={key:2,class:"col-md-4"},ce={class:"card"},ve={class:"card-body"},_e=["value"],me={key:3,class:"col-md-4"},be={class:"card"},pe={class:"card-body"},he={key:4,class:"col-md-4"},fe={class:"card"},ge={class:"card-body"},ye={class:"mb-4"},Ae=["disabled"],ke={key:0},Se={key:1},De={key:0,class:"alert alert-danger"},Ie={key:1,class:"card"},we={class:"card-body"},Me={class:"d-flex justify-content-between align-items-center mb-3"},Re={class:"mb-0 text-muted"},xe={class:"table-responsive"},Ee={class:"table table-hover"},Te={class:"badge bg-success"},Ce={class:"badge bg-danger"},ze={class:"badge bg-warning text-dark"},Fe={class:"badge bg-info"},Ne={class:"badge bg-secondary"},Ve=["onClick"],Le={class:"mt-4"},Oe={class:"modal-dialog modal-xl"},Pe={class:"modal-content"},Ue={class:"modal-header"},Be={class:"modal-title"},je={class:"modal-body"},qe={key:0,class:"text-center py-4"},$e={key:1,class:"alert alert-danger"},He={key:2,class:"table-responsive"},Ke={class:"table table-bordered"},Ye={key:0},Ge={key:1,class:"text-muted"},Je={key:0},Qe={key:1,class:"text-muted"},Ze={key:3,class:"alert alert-info"},oa={__name:"Reportes",setup(We){const u=r("semanal"),b=r(""),I=r(new Date().getMonth()+1),w=r(new Date().getFullYear()),p=r(""),h=r(""),c=r(null),f=r(!1),v=r(""),E=r(null);let M=null;const T=r(null),g=r([]),y=r(!1),A=r(""),V=K(()=>{const o=new Date().getFullYear();return Array.from({length:11},(a,d)=>o-5+d)}),L=o=>["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][o-1],O=()=>{b.value="",p.value="",h.value="",c.value=null,v.value=""},P=async()=>{var o,a;f.value=!0,v.value="",c.value=null;try{let d;switch(u.value){case"semanal":d=await D.getReporteSemanal(b.value||null);break;case"quincenal":d=await D.getReporteQuincenal(b.value||null);break;case"mensual":d=await D.getReporteMensual(I.value,w.value);break;case"personalizado":if(!p.value||!h.value){v.value="Debe seleccionar ambas fechas",f.value=!1;return}d=await D.getReportePeriodo(p.value,h.value);break}c.value=d}catch(d){v.value=((a=(o=d.response)==null?void 0:o.data)==null?void 0:a.detail)||"Error al generar reporte"}finally{f.value=!1}},U=async o=>{var a,d;T.value=o,g.value=[],y.value=!0,A.value="",M||(M=new Z(E.value)),M.show();try{const _=localStorage.getItem("token"),s=await J.get(`http://localhost:8000/asistencias/trabajador/${o.trabajador_id}`,{params:{fecha_inicio:c.value.fecha_inicio,fecha_fin:c.value.fecha_fin},headers:{Authorization:`Bearer ${_}`}});g.value=s.data}catch(_){A.value=((d=(a=_.response)==null?void 0:a.data)==null?void 0:d.detail)||"Error al cargar detalle de asistencias"}finally{y.value=!1}},B=o=>{const a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return new Date(o+"T00:00:00").toLocaleDateString("es-ES",a)},C=o=>o?o.split(".")[0]:"",z=o=>({A_TIEMPO:"A Tiempo",TARDANZA:"Tardanza",SALIDA_OK:"Salida OK",SALIDA_ANTICIPADA:"Salida Anticipada",SIN_SALIDA:"Sin Salida",SIN_HORARIO:"Sin Horario"})[o]||o,j=o=>{switch(o){case"A_TIEMPO":return"bg-success";case"TARDANZA":return"bg-danger";default:return"bg-secondary"}},q=o=>{switch(o){case"SALIDA_OK":return"bg-success";case"SALIDA_ANTICIPADA":return"bg-warning text-dark";case"SIN_SALIDA":return"bg-secondary";default:return"bg-secondary"}};return $(()=>{}),(o,a)=>{var _;const d=Y("router-link");return l(),t("div",null,[F(Q),e("div",W,[a[17]||(a[17]=e("h3",{class:"mb-4"},"Reportes de Asistencia",-1)),e("div",X,[e("div",ee,[e("div",ae,[e("div",se,[a[7]||(a[7]=e("label",{class:"form-label"},"Tipo de Reporte",-1)),m(e("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>u.value=s),class:"form-select",onChange:O},[...a[6]||(a[6]=[e("option",{value:"semanal"},"Semanal",-1),e("option",{value:"quincenal"},"Quincenal",-1),e("option",{value:"mensual"},"Mensual",-1),e("option",{value:"personalizado"},"Personalizado",-1)])],544),[[R,u.value]])])])]),u.value==="semanal"||u.value==="quincenal"?(l(),t("div",te,[e("div",le,[e("div",oe,[a[8]||(a[8]=e("label",{class:"form-label"},"Fecha de Referencia",-1)),m(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>b.value=s),type:"date",class:"form-control"},null,512),[[x,b.value]])])])])):i("",!0),u.value==="mensual"?(l(),t("div",ne,[e("div",de,[e("div",re,[a[9]||(a[9]=e("label",{class:"form-label"},"Mes",-1)),m(e("select",{"onUpdate:modelValue":a[2]||(a[2]=s=>I.value=s),class:"form-select"},[(l(),t(k,null,S(12,s=>e("option",{key:s,value:s},n(L(s)),9,ie)),64))],512),[[R,I.value]])])])])):i("",!0),u.value==="mensual"?(l(),t("div",ue,[e("div",ce,[e("div",ve,[a[10]||(a[10]=e("label",{class:"form-label"},"Año",-1)),m(e("select",{"onUpdate:modelValue":a[3]||(a[3]=s=>w.value=s),class:"form-select"},[(l(!0),t(k,null,S(V.value,s=>(l(),t("option",{key:s,value:s},n(s),9,_e))),128))],512),[[R,w.value]])])])])):i("",!0),u.value==="personalizado"?(l(),t("div",me,[e("div",be,[e("div",pe,[a[11]||(a[11]=e("label",{class:"form-label"},"Fecha Inicio",-1)),m(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>p.value=s),type:"date",class:"form-control"},null,512),[[x,p.value]])])])])):i("",!0),u.value==="personalizado"?(l(),t("div",he,[e("div",fe,[e("div",ge,[a[12]||(a[12]=e("label",{class:"form-label"},"Fecha Fin",-1)),m(e("input",{"onUpdate:modelValue":a[5]||(a[5]=s=>h.value=s),type:"date",class:"form-control"},null,512),[[x,h.value]])])])])):i("",!0)]),e("div",ye,[e("button",{onClick:P,class:"btn btn-primary btn-lg",disabled:f.value},[f.value?(l(),t("span",ke,"Generando...")):(l(),t("span",Se,"Generar Reporte"))],8,Ae)]),v.value?(l(),t("div",De,n(v.value),1)):i("",!0),c.value?(l(),t("div",Ie,[e("div",we,[e("div",Me,[e("h5",null,"Reporte "+n(u.value.toUpperCase()),1),e("p",Re," Periodo: "+n(c.value.fecha_inicio)+" al "+n(c.value.fecha_fin),1)]),e("div",xe,[e("table",Ee,[a[14]||(a[14]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Trabajador"),e("th",null,"Total Días"),e("th",null,"Asistidos"),e("th",null,"Faltados"),e("th",null,"Tardanzas"),e("th",null,"A Tiempo"),e("th",null,"Sal. Anticipadas"),e("th",null,"% Asistencia"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(l(!0),t(k,null,S(c.value.trabajadores,s=>(l(),t("tr",{key:s.trabajador_id},[e("td",null,[e("strong",null,n(s.trabajador_nombre),1)]),e("td",null,n(s.total_dias),1),e("td",null,[e("span",Te,n(s.dias_asistidos),1)]),e("td",null,[e("span",Ce,n(s.dias_faltados),1)]),e("td",null,[e("span",ze,n(s.tardanzas),1)]),e("td",null,[e("span",Fe,n(s.a_tiempo),1)]),e("td",null,[e("span",Ne,n(s.salidas_anticipadas),1)]),e("td",null,[e("strong",null,n(s.porcentaje_asistencia)+"%",1)]),e("td",null,[e("button",{onClick:Xe=>U(s),class:"btn btn-sm btn-outline-primary",title:"Ver detalle de asistencias"},[...a[13]||(a[13]=[e("i",{class:"bi bi-eye"},null,-1)])],8,Ve)])]))),128))])])]),a[15]||(a[15]=e("div",{class:"alert alert-info mt-4"},[e("h6",null,"Información para Planilla"),e("p",{class:"mb-0"}," Este reporte muestra los días trabajados y tardanzas de cada trabajador. Úsalo para calcular descuentos por faltas, tardanzas y bonos por asistencia perfecta. ")],-1))])])):i("",!0),e("div",Le,[F(d,{to:"/",class:"btn btn-secondary"},{default:H(()=>[...a[16]||(a[16]=[G(" Volver al Inicio ",-1)])]),_:1})])]),e("div",{class:"modal fade",id:"detalleModal",tabindex:"-1",ref_key:"detalleModalElement",ref:E},[e("div",Oe,[e("div",Pe,[e("div",Ue,[e("h5",Be," Detalle de Asistencias - "+n((_=T.value)==null?void 0:_.trabajador_nombre),1),a[18]||(a[18]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),e("div",je,[y.value?(l(),t("div",qe,[...a[19]||(a[19]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Cargando...")],-1)])])):i("",!0),A.value?(l(),t("div",$e,n(A.value),1)):i("",!0),g.value.length>0?(l(),t("div",He,[e("table",Ke,[a[20]||(a[20]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Entrada"),e("th",null,"Estado Entrada"),e("th",null,"Salida"),e("th",null,"Estado Salida")])],-1)),e("tbody",null,[(l(!0),t(k,null,S(g.value,s=>(l(),t("tr",{key:s.fecha},[e("td",null,[e("strong",null,n(B(s.fecha)),1)]),e("td",null,[s.hora_entrada?(l(),t("span",Ye,n(C(s.hora_entrada)),1)):(l(),t("span",Ge,"Sin registro"))]),e("td",null,[s.estado_entrada?(l(),t("span",{key:0,class:N(["badge",j(s.estado_entrada)])},n(z(s.estado_entrada)),3)):i("",!0)]),e("td",null,[s.hora_salida?(l(),t("span",Je,n(C(s.hora_salida)),1)):(l(),t("span",Qe,"Sin registro"))]),e("td",null,[s.estado_salida?(l(),t("span",{key:0,class:N(["badge",q(s.estado_salida)])},n(z(s.estado_salida)),3)):i("",!0)])]))),128))])])])):i("",!0),!y.value&&g.value.length===0?(l(),t("div",Ze," No hay registros de asistencia para este trabajador en el período seleccionado. ")):i("",!0)]),a[21]||(a[21]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Cerrar ")],-1))])])],512)])}}};export{oa as default};
